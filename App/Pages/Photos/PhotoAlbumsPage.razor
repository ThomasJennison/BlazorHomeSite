@page "/photoAlbumsPage"
@inject IPhotoAlbumService PhotoAlbumService;

@using BlazorHomeSite.Data.Domain;
@using BlazorHomeSite.Data;
@using BlazorHomeSite.Services.Photos.PhotoAlbums;

<PageTitle>Photo Albums</PageTitle>

<MudPaper Style="padding: 2%">
    <MudStack>

    <MudPaper Style="padding: 2%">
        <CascadingAuthenticationState>
            <AuthorizeView Roles="Admin">
                <MudPaper>
                    <MudStack Row="true">
                        <MudText>Create New Photo Album</MudText>

                        <MudTextField Label="Name"
                                        Variant="Variant.Outlined"
                                        @bind-Value=_newAlbumName
                                        T="string"/>

                        <MudTextField Label="Description"
                                      Variant="Variant.Outlined"
                                      @bind-Value=_newAlbumDescription
                                      T="string" />

                        <MudSelect T="UserLevel" Label="UserLevel" AnchorOrigin="Origin.BottomCenter" @bind-Value=_newAlbumUserLevel>
                            <MudSelectItem Value="@(UserLevel.NoAccount)" />
                            <MudSelectItem Value="@(UserLevel.Registered)" />
                            <MudSelectItem Value="@(UserLevel.Trusted)" />
                            <MudSelectItem Value="@(UserLevel.Admin)" />
                        </MudSelect>

                            <MudFab StartIcon="@Icons.Material.Filled.Add" Color="Color.Success" OnClick="AddNewPhotoAlbum"></MudFab>
              
                    </MudStack>
                </MudPaper>
            </AuthorizeView>
        </CascadingAuthenticationState>
    </MudPaper>
        <MudTable Items="@_photoAlbums" Hover="true" Breakpoint="Breakpoint.Sm" Loading="@_loading" LoadingProgressColor="Color.Info">
            <HeaderContent>
                <MudTh>Name</MudTh>
                <MudTh>Description</MudTh>
                <MudTh></MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="Name">@context.Name</MudTd>
                <MudTd DataLabel="Description">@context.Description</MudTd>

                <MudNavLink Href=@GetAlbumNavigationPath(context.Id)
                                IconColor="Color.Surface"
                                Match="NavLinkMatch.Prefix"
                                Icon="@Icons.Material.Filled.NavigateNext">
                    
                    </MudNavLink>
               
            </RowTemplate>
        </MudTable>


    </MudStack>
</MudPaper>
@code{
    List<PhotoAlbum> _photoAlbums = new List<PhotoAlbum>();
    string _newAlbumDescription = string.Empty;
    string _newAlbumName = string.Empty;
    UserLevel _newAlbumUserLevel = UserLevel.NoAccount;

    

    private string GetAlbumNavigationPath(int id)
    {
        return $"/photoAlbumPage/{id}";
    }

    bool _loading = true;

    protected override async Task OnInitializedAsync()
    {
        _loading = true;
        await base.OnInitializedAsync();
        _photoAlbums = await PhotoAlbumService.GetAllAlbumsAsync();
        _loading = false;
    }

    async Task AddNewPhotoAlbum()
    {
        _loading = true;
        await PhotoAlbumService.CreateNewPhotoAlbumAsync(_newAlbumName, _newAlbumDescription, _newAlbumUserLevel);
        _photoAlbums = await PhotoAlbumService.GetAllAlbumsAsync();
        StateHasChanged();
        _loading = false;
    }

}
